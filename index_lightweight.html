<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MERRILY ã‚«ãƒ•ã‚§ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, sans-serif; background: #f5f5f5; }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    .card { background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; }
    .btn-primary { background: #2D8B5F; color: white; }
    .btn-secondary { background: #ddd; color: #333; }
    .error { background: #fee; color: #c00; padding: 12px; border-radius: 6px; margin: 10px 0; }
    .success { background: #e8f5e9; color: #2e7d32; padding: 12px; border-radius: 6px; margin: 10px 0; }
    .loading { text-align: center; padding: 40px; }
    input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; margin: 8px 0; }
    label { display: block; margin: 10px 0 5px; font-weight: 500; }
    h1 { color: #2D8B5F; margin-bottom: 20px; }
    h2 { margin-bottom: 15px; }
    .debug { background: #f0f0f0; padding: 10px; border-radius: 6px; font-family: monospace; font-size: 12px; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState } = React;
    
    // â˜…â˜…â˜… ã‚ãªãŸã®APIã®URL â˜…â˜…â˜…
    const API_URL = 'https://script.google.com/macros/s/AKfycbzR4W8eaZd00mpqxZZ7qWSbDjO2eWUQCgpC8lc1YbIWkdFUXF1e9_uVJibr_MDZGcIGqw/exec';

    async function apiCall(action, params = {}) {
      const sessionToken = localStorage.getItem('sessionToken');
      const requestBody = { action, ...params };
      if (sessionToken) requestBody.sessionToken = sessionToken;
      
      console.log('ğŸ“¤ API Request:', action);
      
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(requestBody),
          mode: 'cors'
        });
        
        console.log('ğŸ“¥ Response:', response.status, response.statusText);
        
        if (!response.ok) {
          const text = await response.text();
          throw new Error(`HTTP ${response.status}: ${text.substring(0, 100)}`);
        }
        
        const contentType = response.headers.get('content-type');
        let data;
        
        if (contentType?.includes('application/json')) {
          data = await response.json();
        } else {
          const text = await response.text();
          if (text.includes('<!DOCTYPE') || text.includes('<html')) {
            throw new Error('HTMLãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å—ä¿¡ã€‚URLãŒæ­£ã—ã„ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
          }
          data = JSON.parse(text);
        }
        
        console.log('âœ… Success:', data);
        return data;
      } catch (error) {
        console.error('âŒ Error:', error);
        throw error;
      }
    }

    function App() {
      const [status, setStatus] = useState('');
      const [loading, setLoading] = useState(false);
      const [debugInfo, setDebugInfo] = useState('');
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');

      const testConnection = async () => {
        setLoading(true);
        setStatus('');
        setDebugInfo('');
        
        try {
          const result = await fetch(API_URL, { method: 'GET' });
          const data = await result.json();
          setStatus('success');
          setDebugInfo(JSON.stringify(data, null, 2));
        } catch (error) {
          setStatus('error');
          setDebugInfo(error.message);
        } finally {
          setLoading(false);
        }
      };

      const handleLogin = async (e) => {
        e.preventDefault();
        setLoading(true);
        setStatus('');
        setDebugInfo('');
        
        try {
          const result = await apiCall('login', { email, password });
          
          if (result.success) {
            setStatus('success');
            setDebugInfo('ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼\n' + JSON.stringify(result.data, null, 2));
            localStorage.setItem('sessionToken', result.data.sessionToken);
          } else {
            setStatus('error');
            setDebugInfo(result.message);
          }
        } catch (error) {
          setStatus('error');
          setDebugInfo(error.message);
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="container">
          <h1>ğŸµ MERRILY ã‚«ãƒ•ã‚§ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
          
          <div className="card">
            <h2>APIæ¥ç¶šãƒ†ã‚¹ãƒˆ</h2>
            <p style={{marginBottom: '10px'}}>ã¾ãšã€APIã«æ¥ç¶šã§ãã‚‹ã‹ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚</p>
            <button 
              className="btn btn-primary" 
              onClick={testConnection}
              disabled={loading}
            >
              {loading ? 'æ¥ç¶šä¸­...' : 'APIæ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆ'}
            </button>
            
            {status === 'success' && (
              <div className="success" style={{marginTop: '10px'}}>
                âœ… APIæ¥ç¶šæˆåŠŸï¼ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å—ä¿¡ã—ã¾ã—ãŸã€‚
              </div>
            )}
            
            {status === 'error' && (
              <div className="error" style={{marginTop: '10px'}}>
                âŒ æ¥ç¶šã‚¨ãƒ©ãƒ¼: {debugInfo}
              </div>
            )}
            
            {debugInfo && status === 'success' && (
              <div className="debug" style={{marginTop: '10px'}}>
                {debugInfo}
              </div>
            )}
          </div>

          <div className="card">
            <h2>ãƒ­ã‚°ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆ</h2>
            <form onSubmit={handleLogin}>
              <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
              <input 
                type="email" 
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                placeholder="test@example.com"
                required
              />
              
              <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
              <input 
                type="password"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                placeholder="password"
                required
              />
              
              <button 
                type="submit"
                className="btn btn-primary"
                disabled={loading}
                style={{marginTop: '10px'}}
              >
                {loading ? 'ãƒ­ã‚°ã‚¤ãƒ³ä¸­...' : 'ãƒ­ã‚°ã‚¤ãƒ³'}
              </button>
            </form>
          </div>

          <div className="card">
            <h2>ğŸ“‹ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</h2>
            <ul style={{paddingLeft: '20px', lineHeight: '1.8'}}>
              <li>APIæ¥ç¶šãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹å ´åˆï¼š
                <ul style={{paddingLeft: '20px', marginTop: '5px'}}>
                  <li>Google Apps Scriptã®ã€Œã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ãŒã€Œå…¨å“¡ã€ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª</li>
                  <li>URLãŒ <code>/exec</code> ã§çµ‚ã‚ã£ã¦ã„ã‚‹ã‹ç¢ºèª</li>
                  <li>ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆF12ï¼‰ã§ã‚¨ãƒ©ãƒ¼è©³ç´°ã‚’ç¢ºèª</li>
                </ul>
              </li>
              <li>ãƒ­ã‚°ã‚¤ãƒ³ãŒå¤±æ•—ã™ã‚‹å ´åˆï¼š
                <ul style={{paddingLeft: '20px', marginTop: '5px'}}>
                  <li>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ã€Œãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†ã€ã‚·ãƒ¼ãƒˆãŒã‚ã‚‹ã‹ç¢ºèª</li>
                  <li>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª</li>
                </ul>
              </li>
            </ul>
          </div>

          <div className="card">
            <h2>ğŸ” ç¾åœ¨ã®è¨­å®š</h2>
            <div className="debug">
API URL: {API_URL}
ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: è»½é‡ç‰ˆï¼ˆç´„15KBï¼‰
Reactãƒãƒ¼ã‚¸ãƒ§ãƒ³: 18
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
