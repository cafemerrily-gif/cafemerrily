<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒ­ã‚°ã‚¤ãƒ³ - MERRILY ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
  <style>
    /* ===== ãƒªã‚»ãƒƒãƒˆ & åŸºæœ¬è¨­å®š ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Noto Sans JP', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #F5F5DC 0%, #E8DCC4 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    
    /* ===== ãƒ­ã‚´ & ãƒ¡ã‚¤ãƒ³ã‚«ãƒ©ãƒ¼ ===== */
    :root {
      --primary-brown: #8B4513;
      --primary-green: #2E7D32;
      --accent-orange: #FF9800;
      --bg-light: #FFFFFF;
      --text-dark: #3E2723;
      --success: #4CAF50;
      --error: #F44336;
      --warning: #FFC107;
    }
    
    /* ===== ãƒ­ã‚°ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ ===== */
    .login-container {
      background: var(--bg-light);
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
      padding: 50px 40px;
      width: 100%;
      max-width: 450px;
      animation: fadeIn 0.5s ease-in;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* ===== ãƒ­ã‚´ã‚¨ãƒªã‚¢ ===== */
    .logo-area {
      text-align: center;
      margin-bottom: 40px;
    }
    
    .logo-area img {
      width: 200px;
      height: auto;
      margin-bottom: 20px;
    }
    
    .logo-area h1 {
      font-size: 24px;
      color: var(--primary-brown);
      font-weight: 700;
      margin-bottom: 8px;
    }
    
    .logo-area p {
      font-size: 14px;
      color: #666;
    }
    
    /* ===== ãƒ•ã‚©ãƒ¼ãƒ  ===== */
    .form-group {
      margin-bottom: 24px;
    }
    
    .form-group label {
      display: flex;
      align-items: center;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-dark);
      margin-bottom: 8px;
    }
    
    .form-group label::before {
      content: '';
      display: inline-block;
      width: 20px;
      height: 20px;
      margin-right: 8px;
    }
    
    .form-group.email label::before {
      content: 'ğŸ“§';
    }
    
    .form-group.password label::before {
      content: 'ğŸ”’';
    }
    
    .form-group input {
      width: 100%;
      padding: 14px 16px;
      font-size: 16px;
      border: 2px solid #E0E0E0;
      border-radius: 10px;
      transition: all 0.3s;
      font-family: inherit;
    }
    
    .form-group input:focus {
      outline: none;
      border-color: var(--primary-brown);
      box-shadow: 0 0 0 4px rgba(139, 69, 19, 0.1);
    }
    
    /* ===== ãƒœã‚¿ãƒ³ ===== */
    .btn {
      width: 100%;
      padding: 16px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      font-family: inherit;
    }
    
    .btn-primary {
      background: var(--primary-brown);
      color: white;
      margin-bottom: 16px;
    }
    
    .btn-primary:hover {
      background: #6F3709;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(139, 69, 19, 0.3);
    }
    
    .btn-primary:active {
      transform: translateY(0);
    }
    
    .btn-primary:disabled {
      background: #CCC;
      cursor: not-allowed;
      transform: none;
    }
    
    /* ===== ãƒ‡ãƒãƒƒã‚°ã‚¨ãƒªã‚¢ ===== */
    .debug-section {
      margin-top: 40px;
      padding-top: 30px;
      border-top: 2px dashed #E0E0E0;
    }
    
    .debug-title {
      font-size: 14px;
      font-weight: 600;
      color: #666;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
    }
    
    .debug-title::before {
      content: 'ğŸ”§';
      margin-right: 8px;
    }
    
    .btn-test {
      background: var(--primary-green);
      color: white;
    }
    
    .btn-test:hover {
      background: #1B5E20;
    }
    
    /* ===== ãƒ†ã‚¹ãƒˆçµæœè¡¨ç¤º ===== */
    .test-result {
      margin-top: 16px;
      padding: 16px;
      border-radius: 10px;
      font-size: 14px;
      line-height: 1.6;
      display: none;
      animation: slideDown 0.3s ease-out;
    }
    
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .test-result.show {
      display: block;
    }
    
    .test-result.success {
      background: #E8F5E9;
      border: 2px solid var(--success);
      color: #1B5E20;
    }
    
    .test-result.error {
      background: #FFEBEE;
      border: 2px solid var(--error);
      color: #B71C1C;
    }
    
    .test-result strong {
      display: block;
      font-size: 16px;
      margin-bottom: 8px;
    }
    
    .test-result-details {
      margin-top: 12px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 6px;
      font-size: 12px;
      font-family: 'Courier New', monospace;
      white-space: pre-wrap;
      word-break: break-all;
    }
    
    /* ===== ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ ===== */
    .error-message {
      margin-top: 16px;
      padding: 12px 16px;
      background: #FFEBEE;
      border: 2px solid var(--error);
      border-radius: 8px;
      color: #B71C1C;
      font-size: 14px;
      display: none;
      animation: shake 0.5s;
    }
    
    .error-message.show {
      display: block;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }
    
    /* ===== ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° ===== */
    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 0.8s linear infinite;
      margin-right: 8px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* ===== APIè¨­å®šãƒ˜ãƒ«ãƒ— ===== */
    .api-help {
      margin-top: 16px;
      padding: 12px;
      background: #FFF9E6;
      border: 1px solid var(--warning);
      border-radius: 8px;
      font-size: 13px;
      line-height: 1.6;
      color: #795548;
    }
    
    .api-help strong {
      display: block;
      margin-bottom: 6px;
    }
    
    /* ===== ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– ===== */
    @media (max-width: 480px) {
      .login-container {
        padding: 30px 24px;
      }
      
      .logo-area h1 {
        font-size: 20px;
      }
      
      .btn {
        padding: 14px;
        font-size: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="login-container">
    <!-- ãƒ­ã‚´ã‚¨ãƒªã‚¢ -->
    <div class="logo-area">
      <img src="https://via.placeholder.com/200x80/8B4513/FFFFFF?text=MERRILY" alt="MERRILY Logo" id="logo-image">
      <h1>ã‚«ãƒ•ã‚§ç·åˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
      <p>å­¦ç”Ÿé‹å–¶ã‚«ãƒ•ã‚§ã®ãŸã‚ã®çµ±åˆç®¡ç†ãƒ„ãƒ¼ãƒ«</p>
    </div>
    
    <!-- ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ  -->
    <form id="login-form">
      <div class="form-group email">
        <label for="email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
        <input type="email" id="email" name="email" placeholder="ä¾‹: yamada@merrily.com" required>
      </div>
      
      <div class="form-group password">
        <label for="password">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
        <input type="password" id="password" name="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›" required>
      </div>
      
      <button type="submit" class="btn btn-primary" id="login-btn">
        ãƒ­ã‚°ã‚¤ãƒ³
      </button>
      
      <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
      <div class="error-message" id="error-message"></div>
    </form>
    
    <!-- ãƒ‡ãƒãƒƒã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="debug-section">
      <div class="debug-title">é–‹ç™ºè€…å‘ã‘ãƒ„ãƒ¼ãƒ«</div>
      
      <button type="button" class="btn btn-test" id="test-api-btn">
        APIæ¥ç¶šãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
      </button>
      
      <!-- ãƒ†ã‚¹ãƒˆçµæœ -->
      <div class="test-result" id="test-result"></div>
      
      <!-- APIè¨­å®šãƒ˜ãƒ«ãƒ— -->
      <div class="api-help">
        <strong>âš ï¸ APIè¨­å®šãŒå¿…è¦ã§ã™</strong>
        ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€Google Apps Scriptã®URLã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚<br>
        ä¸‹è¨˜ã®æ‰‹é †ã§è¨­å®šã—ã¦ãã ã•ã„ï¼š<br>
        1. Apps Scriptã‚’ãƒ‡ãƒ—ãƒ­ã‚¤<br>
        2. å–å¾—ã—ãŸURLã‚’ä¸‹è¨˜ã«è¨­å®š<br>
        3. ã€ŒAPIæ¥ç¶šãƒ†ã‚¹ãƒˆã€ã§ç¢ºèª
      </div>
    </div>
  </div>
  
  <script>
    // ===== è¨­å®š =====
    // âš ï¸ ã“ã“ã«Apps Scriptã®Webã‚¢ãƒ—ãƒªURLã‚’è¨­å®šã—ã¦ãã ã•ã„
    const API_ENDPOINT = 'https://script.google.com/macros/s/AKfycbwkgdkDhmkO1nMMRUWPRml8jDST-XdFQOc9498mjYpkw706NxFPaFGYy3VWepH0S8cB3Q/exec';
    
    // ===== DOMè¦ç´  =====
    const loginForm = document.getElementById('login-form');
    const loginBtn = document.getElementById('login-btn');
    const testApiBtn = document.getElementById('test-api-btn');
    const testResult = document.getElementById('test-result');
    const errorMessage = document.getElementById('error-message');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    
    // ===== APIæ¥ç¶šãƒ†ã‚¹ãƒˆ =====
    testApiBtn.addEventListener('click', async () => {
      // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
      testApiBtn.disabled = true;
      testApiBtn.innerHTML = '<span class="loading"></span>ãƒ†ã‚¹ãƒˆä¸­...';
      
      // çµæœã‚¨ãƒªã‚¢ã‚’ã‚¯ãƒªã‚¢
      testResult.classList.remove('show', 'success', 'error');
      
      try {
        // APIè¨­å®šãƒã‚§ãƒƒã‚¯
        if (API_ENDPOINT === 'YOUR_APPS_SCRIPT_URL_HERE') {
          showTestResult('error', {
            message: 'API URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“',
            details: 'JavaScriptãƒ•ã‚¡ã‚¤ãƒ«å†…ã®ã€ŒAPI_ENDPOINTã€å¤‰æ•°ã«ã€Apps Scriptã®Webã‚¢ãƒ—ãƒªURLã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚'
          });
          return;
        }
        
        const startTime = Date.now();
        
        // ãƒ†ã‚¹ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡
        const response = await fetch(API_ENDPOINT, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            action: 'test',
            timestamp: new Date().toISOString()
          })
        });
        
        const endTime = Date.now();
        const responseTime = endTime - startTime;
        
        if (!response.ok) {
          throw new Error(`HTTPã‚¨ãƒ©ãƒ¼: ${response.status}`);
        }
        
        const data = await response.json();
        
        // æˆåŠŸè¡¨ç¤º
        showTestResult('success', {
          message: 'APIæ¥ç¶šæˆåŠŸï¼',
          details: `ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ : ${responseTime}ms\nã‚µãƒ¼ãƒãƒ¼æ™‚åˆ»: ${data.timestamp}\nã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${data.status}`
        });
        
      } catch (error) {
        // ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
        showTestResult('error', {
          message: 'APIæ¥ç¶šå¤±æ•—',
          details: `ã‚¨ãƒ©ãƒ¼å†…å®¹: ${error.message}\n\nå¯¾å‡¦æ–¹æ³•:\n1. Apps Scriptã®URLãŒæ­£ã—ã„ã‹ç¢ºèª\n2. Webã‚¢ãƒ—ãƒªãŒæ­£ã—ããƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª\n3. ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã€Œå…¨å“¡ã€ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª`
        });
      } finally {
        // ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
        testApiBtn.disabled = false;
        testApiBtn.textContent = 'APIæ¥ç¶šãƒ†ã‚¹ãƒˆå®Ÿè¡Œ';
      }
    });
    
    // ===== ãƒ†ã‚¹ãƒˆçµæœè¡¨ç¤º =====
    function showTestResult(status, data) {
      testResult.classList.add('show', status);
      
      const icon = status === 'success' ? 'âœ…' : 'âŒ';
      const title = status === 'success' ? 'æ¥ç¶šæˆåŠŸï¼' : 'æ¥ç¶šå¤±æ•—';
      
      testResult.innerHTML = `
        ${icon} <strong>${title}</strong><br>
        ${data.message}
        ${data.details ? `<div class="test-result-details">${data.details}</div>` : ''}
      `;
    }
    
    // ===== ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç† =====
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢
      errorMessage.classList.remove('show');
      
      // APIè¨­å®šãƒã‚§ãƒƒã‚¯
      if (API_ENDPOINT === 'YOUR_APPS_SCRIPT_URL_HERE') {
        showError('API URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚å…ˆã«APIæ¥ç¶šãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚');
        return;
      }
      
      // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
      loginBtn.disabled = true;
      loginBtn.innerHTML = '<span class="loading"></span>ãƒ­ã‚°ã‚¤ãƒ³ä¸­...';
      
      try {
        const response = await fetch(API_ENDPOINT, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            action: 'login',
            email: emailInput.value,
            password: passwordInput.value
          })
        });
        
        if (!response.ok) {
          throw new Error('ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
        }
        
        const result = await response.json();
        
        if (result.success) {
          // ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ
          // ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ã‚’ä¿å­˜
          sessionStorage.setItem('userId', result.data.userId);
          sessionStorage.setItem('userName', result.data.name);
          sessionStorage.setItem('userEmail', result.data.email);
          sessionStorage.setItem('userDepartment', result.data.department);
          sessionStorage.setItem('userPermission', result.data.permissionLevel);
          
          // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºï¼ˆçŸ­æ™‚é–“ï¼‰
          loginBtn.innerHTML = 'âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼';
          loginBtn.style.background = '#4CAF50';
          
          // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸é·ç§»ï¼ˆ1ç§’å¾Œï¼‰
          setTimeout(() => {
            window.location.href = 'accounting.html';
          }, 1000);
          
        } else {
          // ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—
          showError(result.message);
        }
        
      } catch (error) {
        showError('ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
      } finally {
        // ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–ï¼ˆã‚¨ãƒ©ãƒ¼æ™‚ã®ã¿ï¼‰
        if (loginBtn.textContent !== 'âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼') {
          loginBtn.disabled = false;
          loginBtn.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³';
        }
      }
    });
    
    // ===== ã‚¨ãƒ©ãƒ¼è¡¨ç¤º =====
    function showError(message) {
      errorMessage.textContent = 'âŒ ' + message;
      errorMessage.classList.add('show');
    }
    
    // ===== ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ =====
    window.addEventListener('DOMContentLoaded', () => {
      // ã™ã§ã«ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã®å ´åˆã¯ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
      if (sessionStorage.getItem('userId')) {
        window.location.href = 'accounting.html';
      }
    });
  </script>
</body>
</html>
